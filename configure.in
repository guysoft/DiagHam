dnl Process this file with autoconf to produce a configure script.
AC_INIT(src/config.h)
AM_INIT_AUTOMAKE(DiagHam,0.01)

AM_CONFIG_HEADER(src/config_ac.h:src/config_ac.h.in)

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CXX
AC_PROG_RANLIB
AC_PROG_INSTALL

dnl Checks for libraries.
AC_CHECK_LIB(m, cos,MATH_LIBS="-lm",AC_MSG_WARN(math lib not found))
AC_CHECK_LIB(pthread, pthread_create,THREAD_LIBS="-lpthread",AC_MSG_WARN(pthread lib not found : can't use SMP))

dnl Checks for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(sys/time.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST

dnl parse lapack option

AC_ARG_ENABLE(lapack, [AC_HELP_STRING([--enable-lapack],[enable LAPACK support])], [HAVE_PKG_LAPACK=$enableval],[HAVE_PKG_LAPACK=no])

AC_ARG_WITH(blas-libs,[AC_HELP_STRING([--with-blas-libs="LIBS"],[BLAS libraries @<:@"-lblas"@:>@])],
[BLAS_LIBS=${withval}
AC_MSG_CHECKING(user-defined BLAS libraries)
AC_MSG_RESULT([${BLAS_LIBS}])
]
)

AC_ARG_WITH(lapack-libs,[AC_HELP_STRING([--with-lapack-libs="LIBS"],[LAPACK libraries @<:@"-llapack -lg2c"@:>@])],
[LAPACK_LIBS=${withval}
AC_MSG_CHECKING(user-defined LAPACK libraries)
AC_MSG_RESULT([${LAPACK_LIBS}])
]
)

AC_ARG_WITH(blas-libdir,
[AC_HELP_STRING([--with-blas-libdir=DIR],[BLAS library directory @<:@BLASROOT/lib@:>@])],
[BLAS_LIBDIR=${withval}
AC_MSG_CHECKING(user-defined BLAS library directory)
AC_MSG_RESULT([${BLAS_LIBDIR}])
]
)

AC_ARG_WITH(lapack-libdir,
[AC_HELP_STRING([--with-lapack-libdir=DIR],[LAPACK library directory @<:@LAPACKROOT/lib@:>@])],
[
LAPACK_LIBDIR=${withval}
AC_MSG_CHECKING(user-defined LAPACK library directory)
AC_MSG_RESULT([${LAPACK_LIBDIR}])
]
)

AC_MSG_CHECKING(whether we are using LAPACK)
AC_MSG_RESULT([${HAVE_PKG_LAPACK}])
 
if test X${HAVE_PKG_LAPACK} = Xyes; then
  AC_DEFINE(HAVE_LAPACK,,[define if we are using LAPACK])
  AC_LANG_PUSH(Fortran 77)
  AC_CHECK_LIB(blas, dgemm, [HAVE_PKG_BLAS=$enableval; BLAS_LIBS="-lblas -lg2c"],AC_MSG_ERROR(BLAS lib not found))
  AC_CHECK_LIB(lapack, dsyev, [HAVE_PKG_LAPACK=$enableval; LAPACK_LIBS="-llapack -lg2c"], AC_MSG_ERROR(LAPACK lib not found), "-lblas")
  AC_LANG_POP(Fortran 77)
dnl   AC_CHECK_LIB(blas, $sgemm, [HAVE_PKG_BLAS=$enableval; BLAS_LIBS="-lblas"], AC_MSG_ERROR(blas lib not found))
dnl   AC_CHECK_LIB(lapack, $cheev, [HAVE_PKG_LAPACK=$enableval; LAPACK_LIBS="-llapack -lgc2f"], AC_MSG_ERROR(lapack lib not found))
fi

AM_CONDITIONAL(BUILD_LAPACK, test X${HAVE_PKG_LAPACK} = Xyes)

AC_ARG_ENABLE(lapack-only, [AC_HELP_STRING([--enable-lapack-only],[use LAPACK routines instead of DiagHam ones])], [USE_PKG_LAPACK_ONLY=$enableval],[USE_PKG_LAPACK_ONLY=no])
AC_MSG_CHECKING(whether we are using only LAPACK routines)
AC_MSG_RESULT([${USE_PKG_LAPACK_ONLY}])
 
if test X${USE_PKG_LAPACK_ONLY} = Xyes; then
  AC_DEFINE(HAVE_LAPACK_ONLY,,[define if we are using LAPACK only])
fi

dnl parse mpi options

AC_ARG_ENABLE(mpi, [AC_HELP_STRING([--enable-mpi],[enable MPI support])], [HAVE_PKG_MPI=$enableval],[HAVE_PKG_MPI=no])
AC_ARG_WITH(mpi-cxx, [AC_HELP_STRING([--with-mpi-cxx], [use MPI C++ compiler (enables MPI) @<:@mpiCC@:>@])],
[HAVE_PKG_MPI=yes 
if test X${withval} = Xyes; then
  MPI_CXX=mpiCC
else
  MPI_CXX=${withval}
fi
AC_MSG_CHECKING(user-defined MPI C++ compiler)
AC_MSG_RESULT([${MPI_CXX}])
]
)

AC_ARG_WITH(mpi-libs,[AC_HELP_STRING([--with-mpi-libs="LIBS"],[MPI libraries @<:@"-lmpi"@:>@])],
[MPI_LIBS=${withval}
AC_MSG_CHECKING(user-defined MPI libraries)
AC_MSG_RESULT([${MPI_LIBS}])
]
)


AC_ARG_WITH(mpi-incdir,[AC_HELP_STRING([--with-mpi-incdir=DIR],[MPI include directory @<:@MPIROOT/include@:>@])],
[
MPI_INC=${withval}
AC_MSG_CHECKING(user-defined MPI includes)
AC_MSG_RESULT([${MPI_INC}])
]
)


AC_ARG_WITH(mpi-libdir,
[AC_HELP_STRING([--with-mpi-libdir=DIR],[MPI library directory @<:@MPIROOT/lib@:>@])],
[
MPI_LIBDIR=${withval}
AC_MSG_CHECKING(user-defined MPI library directory)
AC_MSG_RESULT([${MPI_LIBDIR}])
]
)

AC_MSG_CHECKING(whether we are using MPI)
AC_MSG_RESULT([${HAVE_PKG_MPI}])
 
if test X${HAVE_PKG_MPI} = Xyes; then
  AC_DEFINE(HAVE_MPI,,[define if we are using MPI])
fi

AM_CONDITIONAL(BUILD_MPI, test X${HAVE_PKG_MPI} = Xyes)

dnl check for MPI c++ compiler

if test X${HAVE_PKG_MPI} = Xyes; then

  if test -z "${MPI_DIR}" &&  test -z "${MPI_CXX}"; then
    MPI_CXX=mpiCC
  fi
fi

if test -n "${MPI_CXX}"; then

  if test -f ${MPI_CXX}; then   
    MPI_CXX_EXISTS=yes
  else
    AC_CHECK_PROG(MPI_CXX_EXISTS, ${MPI_CXX}, yes, no)
  fi

  if test "X${MPI_CXX_EXISTS}" = "Xyes"; then
    CXX=${MPI_CXX}
  else
    AC_MSG_ERROR([MPI C++ compiler (${MPI_CXX}) not found.])
  fi

fi

dnl check byte ordering


AC_TRY_RUN([
int main()
{
	short s = 1;
	short* ptr = &s;
	unsigned char c = *((char*)ptr);
	return c;	
}

]
, AC_DEFINE(HAVE_BIGENDIAN, [], [use big endian byte ordering])
, AC_DEFINE(HAVE_LITTLEENDIAN, [], [use little endian byte ordering])
)


dnl Checks for library functions.

dnl CXXFLAGS="-O3 -ffast-math -g -Wall  -march=athlon"
CXXFLAGS="-O2 -g -Wall "
INCLUDES="-I\$(top_srcdir)/src -I\$(top_srcdir)/Base/src"
AC_SUBST(CXXFLAGS)
AC_SUBST(INCLUDES)
AC_SUBST(MATH_LIBS)
AC_SUBST(THREAD_LIBS)
AC_SUBST(BLAS_LIBS)
AC_SUBST(LAPACK_LIBS)

AC_OUTPUT(Makefile src/Makefile src/Programs/Makefile src/Programs/QHE/Makefile src/Programs/QHE/QHEOnSphere/Makefile src/Programs/QHE/QHEOnDisk/Makefile src/Programs/QuantumDot/Makefile src/Programs/Spin/Makefile src/Architecture/Makefile src/Architecture/ArchitectureOperation/Makefile src/Architecture/ArchitectureOperation/QHEArchitectureOperation/Makefile src/Architecture/ArchitectureOperation/SpinArchitectureOperation/Makefile src/FunctionBasis/Makefile src/FunctionBasis/QHEFunctionBasis/Makefile src/Tensor/Makefile src/QuantumNumber/Makefile src/QuantumNumber/QHEQuantumNumber/Makefile src/QuantumNumber/SpinQuantumNumber/Makefile src/Interaction/Makefile src/Interaction/InternalInteraction/Makefile src/HilbertSpace/Makefile src/HilbertSpace/QHEHilbertSpace/Makefile src/HilbertSpace/SpinHilbertSpace/Makefile src/HilbertSpace/DMRGHilbertSpace/Makefile src/HilbertSpace/QuantumDotHilbertSpace/Makefile src/HilbertSpace/ManyBodyHilbertSpace/Makefile src/Output/Makefile src/GeneralTools/Makefile src/Vector/Makefile src/Polynomial/Makefile src/Matrix/Makefile src/LanczosAlgorithm/Makefile src/Hamiltonian/Makefile src/Hamiltonian/QHEHamiltonian/Makefile src/Hamiltonian/QuantumDotHamiltonian/Makefile src/Hamiltonian/SpinHamiltonian/Makefile src/Hamiltonian/DMRGHamiltonian/Makefile src/TensorProduct/Makefile src/DMRGAlgorithm/Makefile src/Operator/Makefile src/MathTools/Makefile src/MathTools/NumericalAnalysis/Makefile src/MathTools/RandomNumber/Makefile src/Options/Makefile src/Tools/Makefile src/Tools/QuantumDot/Makefile src/Tools/QuantumDot/Potential/Makefile src/Tools/QuantumDot/Spectra/Makefile src/MainTask/Makefile src/MainTask/QHEMainTask/Makefile src/Architecture/ClusterArchitecture/Makefile src/Tools/QuantumDot/Analysis/Makefile src/Tools/QHE/Makefile src/Tools/QHE/QHEWaveFunction/Makefile src/Tools/QHE/QHESpectrum/Makefile src/Tools/QHE/QHEFiles/Makefile src/Operator/QHEOperator/Makefile src/Operator/SpinOperator/Makefile Base/Makefile Base/src/Makefile Base/src/BitmapTools/Makefile Base/src/BitmapTools/Color/Makefile Base/src/BitmapTools/BitmapPicture/Makefile )
